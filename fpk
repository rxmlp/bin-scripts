#!/usr/bin/env bash
set -euo pipefail
trap 'echo "Error on line $LINENO: command \"$BASH_COMMAND\" failed"; exit 1' ERR

RESET_COLOR="\033[0m"
TEXT_GREEN="\033[92m"
TEXT_RED="\033[0;31m"
cli="$(basename "$0")"


if [[ -z "${1:-}" ]]; then
    echo -e "${TEXT_GREEN}Usage: $cli {in|rm|clr|help}${RESET_COLOR}"
    exit 1
fi


case "$1" in
  i|in)
    if [[ -z "${2:-}" ]]; then
      echo -e "${TEXT_RED}Error: package name required for $cli in command${RESET_COLOR}"
      echo -e "${TEXT_GREEN}Usage: $cli in <package_name>${RESET_COLOR}"
      exit 1
    fi
    echo -e "${TEXT_GREEN}Install package ${2}...${RESET_COLOR}"
    flatpak install --user "$2"
    echo -e "${TEXT_GREEN}Package installation complete!!${RESET_COLOR}"
    ;;
  r|rm)
    if [[ -z "${2:-}" ]]; then
      echo -e "${TEXT_RED}Error: package name required for $cli rm command${RESET_COLOR}"
      echo -e "${TEXT_GREEN}Usage: $cli rm <package_name>${RESET_COLOR}"
      exit 1
    fi
    echo -e "${TEXT_GREEN}Remove package ${2}...${RESET_COLOR}"
    flatpak remove --user "$2"
    echo -e "${TEXT_GREEN}Package $2 removed!!${RESET_COLOR}"
    ;;
  c|clr)
    echo -e "${TEXT_GREEN}Cleaning up cache...${RESET_COLOR}"
    flatpak uninstall --user --unused --noninteractive
    echo -e "${TEXT_GREEN}Cache cleaned!!${RESET_COLOR}"
    ;;
  l|ls)
    echo -e "${TEXT_GREEN}Installed packages${RESET_COLOR}"
    flatpak --user list
    ;;
  h|help|--help)
    echo -e "${TEXT_GREEN}Usage: $cli <command> [args]${RESET_COLOR}"
    echo -e "${TEXT_GREEN}Commands:${RESET_COLOR}"
    echo -e "  i|in <pkg>   - Install a Flatpak package for the user (non-interactive)"
    echo -e "  r|rm <pkg>   - Remove a Flatpak package for the user (non-interactive)"
    echo -e "  c|clr        - Cleanup unused Flatpak user runtimes and packages"
    echo -e "  l|lst        - Lists installed user packages"
    echo -e "  h|help       - Show this help message"
    exit 0
    ;;
  *)
    echo -e "${TEXT_GREEN}Usage: $cli {in|rm|clr|help}${RESET_COLOR}"
    exit 1
    ;;
esac
